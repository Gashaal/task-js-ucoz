!function(){"use strict";window.app={init:function(){var t,e,o=localStorage.getItem("books"),r=new app.BookForm;o&&"{}"!==o?o=JSON.parse(o):(o={},localStorage.setItem("books","{}"));for(var i in o)t=new app.Book(o[i]),e=new app.BookItemView(t),e.on("edit",r.setBook.bind(r)),e.render()}}}(),function(){"use strict";var t=function(){};t.prototype.events={},t.prototype.on=function(t,e){return this.events[t]||(this.events[t]=new Array),this.events[t].push(e)},t.prototype.off=function(t,e){var o;this.events[t]&&(o=this.events[t].indexOf(e),o!==-1&&callbacks.splice(o,1))},t.prototype.trigger=function(t,e){var o;if(this.events[t]){o=this.events[t];for(var r=0;r<o.length;r++)o[r](e)}},app.Observer=t}(),function(){"use strict";var t=function(t){if(!(t.author&&t.name&&t.year&&t.pages))throw new TypeError("params is not valid");t.id&&(this.id=t.id,delete t.id),this.attrs=t};t.prototype=Object.create(app.Observer.prototype),t.prototype.constructor=t,t.prototype.isNew=function(){return!!this.id},t.prototype.save=function(){var t=JSON.parse(localStorage.getItem("books")),e=this.attrs;this.isNew()||(this.id=Math.random().toString(36).slice(2),t[this.id]={});for(var o in e)t[this.id][o]=e[o];t[this.id].id=this.id,localStorage.setItem("books",JSON.stringify(t)),this.trigger("save")},t.prototype.remove=function(){if(!this.isNew())throw new ReferenceError("this book is not saved in localStorage yet");var t=JSON.parse(localStorage.getItem("books"));delete t[this.id],localStorage.setItem("books",JSON.stringify(t)),this.trigger("remove")},app.Book=t}(),function(){"use strict";var t=function(t){this.book=t,this.targetEl=document.querySelector(".list-wrapper"),this.tagName="div",this.templateId="book-item",this.isRendered=!1,this.book.on("save",this.update.bind(this))};t.prototype=Object.create(app.Observer.prototype),t.prototype.constructor=t,t.prototype.render=function(){if(!this.isRendered){var t=document.getElementById(this.templateId).innerHTML,e=document.createElement(this.tagName);e.innerHTML=t,e.setAttribute("class","book-wrapper"),e.querySelector(".book-action__edit").addEventListener("click",this.edit.bind(this)),e.querySelector(".book-action__remove").addEventListener("click",this.destroy.bind(this)),e.querySelector(".book-info__name").innerHTML=this.book.attrs.name,e.querySelector(".book-info__author").innerHTML=this.book.attrs.author,this.el=e,this.update(),this.targetEl.appendChild(this.el),this.isRendered=!0}return this},t.prototype.update=function(){return this.el.querySelector(".book-info__name").innerHTML=this.book.attrs.name,this.el.querySelector(".book-info__author").innerHTML=this.book.attrs.author,this},t.prototype.edit=function(){return this.trigger("edit",this.book),this},t.prototype.destroy=function(){this.targetEl.removeChild(this.el),this.book.off("save",this.update.bind(this)),this.book.remove()},app.BookItemView=t}(),function(){"use strict";var t=function(){var e=this;this.book=null,this.form=document.querySelector(".book-form"),this.form.reset(),this.fields={},this.fields.name=this.form.querySelector(".book-form__name"),this.fields.author=this.form.querySelector(".book-form__author"),this.fields.year=this.form.querySelector(".book-form__year"),this.fields.pages=this.form.querySelector(".book-form__pages");var o=function(t){13==t.keyCode&&t.preventDefault()};for(var r in this.fields)this.fields[r].addEventListener("keypress",o);this.header=this.form.querySelector(".book-form__header"),this.error=this.form.querySelector(".book-form__error"),this.error_text=this.error.querySelector(".header"),this.form.querySelector(".book-form__cancel").addEventListener("click",function(t){t.preventDefault(),e.reset()}),this.form.querySelector(".book-form__save").addEventListener("click",function(t){t.preventDefault(),e.save()}),this.reset=function(){return this.book=null,this.error.style.display="none",this.header.innerHTML="Создание новой книги",this.form.reset(),this},this.getData=function(){var t={};return t.name=this.fields.name.value,t.author=this.fields.author.value,t.year=+this.fields.year.value,t.pages=+this.fields.pages.value,t.name&&t.author?t.year<=0?(this.error_text.innerHTML='"Год издания" должен быть больше 0!',this.error.style.display="block",!1):t.pages<=0?(this.error_text.innerHTML='"Количество страниц" должно быть больше 0!',this.error.style.display="block",!1):(this.error.style.display="none",t):(this.error_text.innerHTML='Заполните поля "Название" и "Автор"!',this.error.style.display="block",!1)},this.save=function(){var t=this.getData();if(t){if(this.book)this.book.attrs=t;else{this.book=new app.Book(t);var e=new app.BookItemView(this.book).render();e.on("edit",this.setBook.bind(this))}this.book.save(),this.reset()}return this},this.setBook=function(t){this.book=t;var e=t.attrs;this.book.on("remove",this.reset.bind(this)),this.header.innerHTML=e.name;for(var o in e)this.fields[o].value=e[o];return this},t=function(){return e}};app.BookForm=t}();